<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Syst√®me de Commande - Restaurant Trial+</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container-test {
            max-width: 1000px;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-left: 4px solid #d32f2f;
            border-radius: 8px;
        }
        .test-btn {
            background: linear-gradient(135deg, #d32f2f 0%, #1976d2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        .test-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .test-result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }
        .success {
            color: #4caf50;
            font-weight: bold;
        }
        .error {
            color: #f44336;
            font-weight: bold;
        }
        .info {
            color: #1976d2;
        }
        h2 {
            color: #d32f2f;
            margin-top: 30px;
            border-bottom: 2px solid #d32f2f;
            padding-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container-test">
        <h1 style="color: #d32f2f; text-align: center; margin-bottom: 30px;">
            üß™ Test Syst√®me de Commande - Restaurant Trial+
        </h1>

        <h2>√âtat du Syst√®me</h2>
        <div class="test-section">
            <button class="test-btn" onclick="testDatabase()">‚úì V√©rifier la Base de Donn√©es</button>
            <button class="test-btn" onclick="testDishes()">üçΩÔ∏è  V√©rifier les Plats</button>
            <button class="test-btn" onclick="testTables()">ü™ë V√©rifier les Tables</button>
            <button class="test-btn" onclick="testOrders()">üìã V√©rifier les Commandes</button>
            <div id="statusResult" class="test-result" style="display:none;"></div>
        </div>

        <h2>Cr√©er une Commande de Test</h2>
        <div class="test-section">
            <p>Note: Vous devez √™tre connect√© pour cr√©er une commande</p>
            <button class="test-btn" onclick="testOrderCreation()">‚ûï Cr√©er Commande Test</button>
            <div id="orderResult" class="test-result" style="display:none;"></div>
        </div>

        <h2>Routes et API</h2>
        <div class="test-section">
            <ul>
                <li><strong>Page d'accueil:</strong> <a href="/">http://localhost:8000/</a></li>
                <li><strong>Admin Commandes:</strong> <a href="/admin/commandes">/admin/commandes</a></li>
                <li><strong>Client Dashboard:</strong> <a href="/client/dashboard">/client/dashboard</a></li>
                <li><strong>Client Menu:</strong> <a href="/client/menu">/client/menu</a></li>
                <li><strong>API Cat√©gories:</strong> <a href="/api/categories">/api/categories</a></li>
            </ul>
        </div>

        <h2>Documentation</h2>
        <div class="test-section">
            <h4>Syst√®me de Commande Corrig√©</h4>
            <p>‚úÖ <strong>Probl√®me 1 R√©solu:</strong> Les deux boutons sur la page d'accueil renvoient maintenant sur le modal de connexion</p>
            <p>‚úÖ <strong>Probl√®me 2 R√©solu:</strong> Le syst√®me de commande enregistre correctement les commandes en base de donn√©es avec:</p>
            <ul>
                <li>Transaction BD (ACID compliant)</li>
                <li>Validation stricte des donn√©es</li>
                <li>Enregistrement des lignes de commande</li>
                <li>Marquage des tables comme occup√©es</li>
                <li>Logs d√©taill√©s pour debug</li>
            </ul>
        </div>
    </div>

    <script>
        async function testDatabase() {
            showResult('statusResult', '‚è≥ Test en cours...');
            try {
                const response = await fetch('/api/categories');
                if (response.ok) {
                    const data = await response.json();
                    showResult('statusResult', `<span class="success">‚úì Connexion BD OK</span><br>Cat√©gories trouv√©es: ${data.length}`);
                } else {
                    showResult('statusResult', `<span class="error">‚úó Erreur API</span>`);
                }
            } catch(e) {
                showResult('statusResult', `<span class="error">‚úó Erreur: ${e.message}</span>`);
            }
        }

        async function testDishes() {
            showResult('statusResult', '‚è≥ Test en cours...');
            try {
                const response = await fetch('/api/categories');
                const categories = await response.json();
                if (categories.length > 0) {
                    const response2 = await fetch(`/api/menu/plats/${categories[0].id}`);
                    const plats = await response2.json();
                    showResult('statusResult', `<span class="success">‚úì Plats Trouv√©s</span><br>Total: ${plats.length}<br><pre>${JSON.stringify(plats.slice(0, 2), null, 2)}</pre>`);
                } else {
                    showResult('statusResult', '<span class="error">‚úó Aucune cat√©gorie</span>');
                }
            } catch(e) {
                showResult('statusResult', `<span class="error">‚úó Erreur: ${e.message}</span>`);
            }
        }

        async function testTables() {
            showResult('statusResult', '‚è≥ Test en cours...');
            try {
                const response = await fetch('/api/tables/statut');
                const data = await response.json();
                showResult('statusResult', `<span class="success">‚úì Tables Trouv√©es</span><br>Total: ${data.length}<br><pre>${JSON.stringify(data.slice(0, 3), null, 2)}</pre>`);
            } catch(e) {
                showResult('statusResult', `<span class="error">‚úó Erreur: ${e.message}</span>`);
            }
        }

        async function testOrders() {
            showResult('statusResult', '‚è≥ V√©rification commandes...');
            try {
                const response = await fetch('/client/orders');
                if (response.status === 401) {
                    showResult('statusResult', '<span class="info">‚ÑπÔ∏è  Vous devez √™tre connect√© pour voir vos commandes</span><br><a href="/login">Se connecter</a>');
                } else if (response.ok) {
                    showResult('statusResult', '<span class="success">‚úì Acc√®s aux commandes OK</span>');
                } else {
                    showResult('statusResult', '<span class="error">‚úó Erreur acc√®s commandes</span>');
                }
            } catch(e) {
                showResult('statusResult', `<span class="error">‚úó Erreur: ${e.message}</span>`);
            }
        }

        async function testOrderCreation() {
            showResult('orderResult', '<span class="info">‚ÑπÔ∏è  Pour cr√©er une commande:</span><br>1. Allez √† <a href="/client/menu">Menu Client</a><br>2. Ajoutez des plats au panier<br>3. Validez votre commande<br><br>Les commandes seront sauvegard√©es en BD et visibles dans <a href="/admin/commandes">Admin Commandes</a>');
        }

        function showResult(elementId, content) {
            const element = document.getElementById(elementId);
            element.innerHTML = content;
            element.style.display = 'block';
        }

        // Test automatique au chargement
        window.addEventListener('load', () => {
            testDatabase();
        });
    </script>
</body>
</html>
